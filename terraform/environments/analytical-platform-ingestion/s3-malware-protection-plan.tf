resource "aws_guardduty_malware_protection_plan" "landing_bucket" {
  role = module.guard_duty_malware_s3_scan_iam_role.iam_role_arn

  protected_resource {
    s3_bucket {
      bucket_name = module.landing_bucket.s3_bucket_id
    }
  }

  actions {
    tagging {
      status = "ENABLED"
    }
  }

  tags = local.tags
}

resource "aws_guardduty_malware_protection_plan" "laa_data_analysis_bucket" {
  count = local.environment == "production" ? 1 : 0

  role = module.guard_duty_malware_s3_scan_iam_role.iam_role_arn

  protected_resource {
    s3_bucket {
      bucket_name = module.laa_data_analysis_bucket[0].s3_bucket_id
    }
  }

  actions {
    tagging {
      status = "ENABLED"
    }
  }

  tags = local.tags
}
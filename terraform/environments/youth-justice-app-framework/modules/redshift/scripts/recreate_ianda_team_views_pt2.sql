SET enable_case_sensitive_identifier TO true;

CREATE VIEW yjb_ianda_team.all_2022 AS SELECT "derived_table1"."source_document_id" AS "source_document_id", "derived_table1"."ypid" AS "ypid", "derived_table1"."currentyotid" AS "currentyotid", "derived_table1"."date_of_birth" AS "date_of_birth", "derived_table1"."ethnicity" AS "ethnicity", "derived_table1"."gender" AS "gender", "derived_table1"."sex" AS "sex", "derived_table1"."pncnumber" AS "pncnumber", "derived_table1"."yot_name" AS "yot_name", "derived_table1"."age_at_arrest_or_offence" AS "age_at_arrest_or_offence", "derived_table1"."age_at_first_hearing" AS "age_at_first_hearing", "derived_table1"."offence_id" AS "offence_id", "derived_table1"."is_substantive" AS "is_substantive", "derived_table1"."offence_date" AS "offence_date", "derived_table1"."offence_description" AS "offence_description", "derived_table1"."yjb_offence_category" AS "yjb_offence_category", "derived_table1"."knife_related_offence" AS "knife_related_offence", "derived_table1"."yjb_seriousness_score" AS "yjb_seriousness_score", "derived_table1"."legal_outcome" AS "legal_outcome", "derived_table1"."legal_outcome_group" AS "legal_outcome_group", "derived_table1"."outcome_appeal_status" AS "outcome_appeal_status", "derived_table1"."outcome_date" AS "outcome_date", "derived_table1"."residence_on_legal_outcome_date" AS "residence_on_legal_outcome_date", "derived_table1"."rn" AS "rn" FROM (SELECT "main_sql"."source_document_id" AS "source_document_id", "main_sql"."ypid" AS "ypid", "main_sql"."currentyotid" AS "currentyotid", "main_sql"."date_of_birth" AS "date_of_birth", "main_sql"."ethnicity" AS "ethnicity", "main_sql"."gender" AS "gender", "main_sql"."sex" AS "sex", "main_sql"."pncnumber" AS "pncnumber", "main_sql"."yot_name" AS "yot_name", "main_sql"."age_at_arrest_or_offence" AS "age_at_arrest_or_offence", "main_sql"."age_at_first_hearing" AS "age_at_first_hearing", "main_sql"."offence_id" AS "offence_id", "main_sql"."is_substantive" AS "is_substantive", "main_sql"."offence_date" AS "offence_date", "main_sql"."offence_description" AS "offence_description", "main_sql"."yjb_offence_category" AS "yjb_offence_category", "main_sql"."knife_related_offence" AS "knife_related_offence", "main_sql"."yjb_seriousness_score" AS "yjb_seriousness_score", "main_sql"."legal_outcome" AS "legal_outcome", "main_sql"."legal_outcome_group" AS "legal_outcome_group", "main_sql"."outcome_appeal_status" AS "outcome_appeal_status", "main_sql"."outcome_date" AS "outcome_date", "main_sql"."residence_on_legal_outcome_date" AS "residence_on_legal_outcome_date", ROW_NUMBER() OVER (PARTITION BY "main_sql"."ypid" ORDER BY "main_sql"."outcome_date" ASC NULLS LAST, "main_sql"."yjb_seriousness_score" DESC NULLS FIRST) AS "rn" FROM (SELECT "person_details"."source_document_id" AS "source_document_id", "person_details"."ypid" AS "ypid", "person_details"."currentyotid" AS "currentyotid", "person_details"."date_of_birth" AS "date_of_birth", "person_details"."ethnicity" AS "ethnicity", "person_details"."gender" AS "gender", "person_details"."sex" AS "sex", "person_details"."pncnumber" AS "pncnumber", "person_details"."yot_name" AS "yot_name", "offence"."age_at_arrest_or_offence" AS "age_at_arrest_or_offence", "offence"."age_at_first_hearing" AS "age_at_first_hearing", "offence"."offence_id" AS "offence_id", "offence"."is_substantive" AS "is_substantive", "offence"."offence_date" AS "offence_date", "offence"."offence_description" AS "offence_description", "offence"."yjb_offence_category" AS "yjb_offence_category", "offence"."knife_related_offence" AS "knife_related_offence", "offence"."yjb_seriousness_score" AS "yjb_seriousness_score", "offence"."legal_outcome" AS "legal_outcome", "offence"."legal_outcome_group" AS "legal_outcome_group", "offence"."outcome_appeal_status" AS "outcome_appeal_status", "offence"."outcome_date" AS "outcome_date", "offence"."residence_on_legal_outcome_date" AS "residence_on_legal_outcome_date" FROM (SELECT "yp_doc_header"."source_document_id" AS "source_document_id", CAST("yp_doc_item"."document_item"."ypid" AS VARCHAR) AS "ypid", CAST("yp_doc_item"."document_item"."dateofbirth" AS DATE) AS "date_of_birth", CAST("yp_doc_item"."document_item"."gender" AS INT4) AS "gender", CAST("yp_doc_item"."document_item"."ethnicity" AS VARCHAR) AS "ethnicity", "yp_doc_item"."document_item"."gendertermused" AS "gender_term_used", CAST("yp_doc_item"."document_item"."sex" AS INT4) AS "sex", CAST("yp_doc_item"."document_item"."pncnumber" AS VARCHAR) AS "pncnumber", "yot"."yot_name" AS "yot_name", "yp_doc_header"."currentyotid" AS "currentyotid" FROM (("stg"."yp_doc_item" AS "yp_doc_item" INNER JOIN "stg"."yp_doc_header" AS "yp_doc_header" ON "yp_doc_header"."source_document_id" = "yp_doc_item"."source_document_id") INNER JOIN "yjb_case_reporting"."mvw_yp_document_header" AS "d" ON "yp_doc_header"."source_document_id" = "d"."source_document_id") LEFT JOIN "refdata"."yotoucodes" AS "yot" ON "yot"."yotoucode" = "d"."yot_ou_code" WHERE "yp_doc_item"."document_item_type" = CAST('person_details' AS VARCHAR)) AS "person_details" INNER JOIN (SELECT "o"."source_document_id" AS "source_document_id", CAST("o"."document_item"."offenceid" AS VARCHAR) AS "offence_id", CAST("o"."document_item"."offencedate" AS DATE) AS "offence_date", CAST("o"."document_item"."ageatarrestoroffence" AS INT4) AS "age_at_arrest_or_offence", CAST("o"."document_item"."ageonfirsthearing" AS INT4) AS "age_at_first_hearing", CAST("o"."document_item"."offencedescription" AS VARCHAR) AS "offence_description", CAST("o"."document_item"."yjboffencecategory" AS VARCHAR(100)) AS "yjb_offence_category", CAST("o"."document_item"."kniferelatedoffence" AS VARCHAR(100)) AS "knife_related_offence", CAST("o"."document_item"."yjbseriousnessscore" AS INT4) AS "yjb_seriousness_score", CAST("olo"."issubstantive" AS BOOL) AS "is_substantive", CAST("olo"."legaloutcome" AS VARCHAR(100)) AS "legal_outcome", CAST("olo"."legaloutcomegroup" AS VARCHAR(100)) AS "legal_outcome_group", CAST("olo"."cmslegaloutcome" AS VARCHAR(100)) AS "cms_legal_outcome", CAST("olo"."outcomeappealstatus" AS VARCHAR(500)) AS "outcome_appeal_status", CAST("olo"."outcomedate" AS DATE) AS "outcome_date", CAST("olo"."residenceonlegaloutcomedate" AS VARCHAR(100)) AS "residence_on_legal_outcome_date" FROM "stg"."yp_doc_item" AS "o" LEFT JOIN "o"."document_item"."offencelegaloutcome" AS "olo" ON CAST(TRUE AS BOOL) WHERE "o"."document_item_type" = CAST('offence' AS VARCHAR)) AS "offence" ON "person_details"."source_document_id" = "offence"."source_document_id" WHERE (((((("offence"."age_at_arrest_or_offence" >= CAST(10 AS INT4)) AND ("offence"."age_at_arrest_or_offence" <= CAST(17 AS INT4))) OR (("offence"."age_at_first_hearing" >= CAST(10 AS INT4)) AND ("offence"."age_at_first_hearing" <= CAST(17 AS INT4)))) AND ("offence"."is_substantive" = CAST(TRUE AS BOOL))) AND (("offence"."outcome_date" >= CAST('2022-01-01' AS DATE)) AND ("offence"."outcome_date" <= CAST('2022-12-31' AS DATE)))) AND ("offence"."residence_on_legal_outcome_date" <> CAST('OTHER' AS VARCHAR))) AND ("offence"."outcome_appeal_status" <> CAST('Changed on appeal' AS VARCHAR))) AS "main_sql") AS "derived_table1";;	
CREATE VIEW yjb_ianda_team.data_request_ecm_2023 AS SELECT "person_details"."source_document_id" AS "source_document_id", "person_details"."ypid" AS "ypid", "person_details"."date_of_birth" AS "date_of_birth", "person_details"."ethnicity" AS "ethnicity", "person_details"."gender" AS "gender", "person_details"."sex" AS "sex", "person_details"."pncnumber" AS "pncnumber", "person_details"."yot_name" AS "yot_name", "offence"."age_at_arrest_or_offence" AS "age_at_arrest_or_offence", "offence"."age_at_first_hearing" AS "age_at_first_hearing", "asset_plus"."rosh_judgement" AS "rosh_judgement", "asset_plus"."mappa_category" AS "mappa_category", "asset_plus"."mappa_level" AS "mappa_level", "asset_plus"."concerns_offence_justification" AS "concerns_offence_justification", "asset_plus"."concerns_offence_attitudes" AS "concerns_offence_attitudes", "asset_plus"."concerns_other_behaviour" AS "concerns_other_behaviour", "asset_plus"."concerns_local_issues" AS "concerns_local_issues", "asset_plus"."concerns_parenting" AS "concerns_parenting", "asset_plus"."concerns_family_behaviour" AS "concerns_family_behaviour", "asset_plus"."concerns_care_history" AS "concerns_care_history", "asset_plus"."concerns_significant_relationships" AS "concerns_significant_relationships", "asset_plus"."concerns_relations_to_others" AS "concerns_relations_to_others", "asset_plus"."concerns_risk_to_others" AS "concerns_risk_to_others", "asset_plus"."concerns_physical_health" AS "concerns_physical_health", "asset_plus"."concerns_safety_and_wellbeing" AS "concerns_safety_and_wellbeing", "asset_plus"."concerns_lifestyle" AS "concerns_lifestyle", "asset_plus"."concerns_mental_health" AS "concerns_mental_health", "asset_plus"."concerns_speech_language_communication" AS "concerns_speech_language_communication", "asset_plus"."concerns_substance_misuse" AS "concerns_substance_misuse", "asset_plus"."concerns_learning_and_ete" AS "concerns_learning_and_ete", "asset_plus"."concerns_accommodation" AS "concerns_accommodation", "offence"."offence_id" AS "offence_id", "offence"."offence_date" AS "offence_date", "offence"."offence_description" AS "offence_description", "offence"."yjb_offence_category" AS "yjb_offence_category", "offence"."knife_related_offence" AS "knife_related_offence", "offence"."yjb_seriousness_score" AS "yjb_seriousness_score", "offence"."legal_outcome" AS "legal_outcome", "offence"."legal_outcome_group" AS "legal_outcome_group", "offence"."outcome_date" AS "outcome_date", "asset_plus"."asset_plus_date" AS "asset_plus_date", "offence"."residence_on_legal_outcome_date" AS "residence_on_legal_outcome_date" FROM (((SELECT "yp_doc_header"."source_document_id" AS "source_document_id", CAST("yp_doc_item"."document_item"."ypid" AS VARCHAR) AS "ypid", CAST("yp_doc_item"."document_item"."dateofbirth" AS DATE) AS "date_of_birth", CAST("yp_doc_item"."document_item"."gender" AS INT4) AS "gender", CAST("yp_doc_item"."document_item"."ethnicity" AS VARCHAR) AS "ethnicity", "yp_doc_item"."document_item"."gendertermused" AS "gender_term_used", CAST("yp_doc_item"."document_item"."sex" AS INT4) AS "sex", CAST("yp_doc_item"."document_item"."pncnumber" AS VARCHAR) AS "pncnumber", "yot"."yot_name" AS "yot_name" FROM (("stg"."yp_doc_item" AS "yp_doc_item" INNER JOIN "stg"."yp_doc_header" AS "yp_doc_header" ON "yp_doc_header"."source_document_id" = "yp_doc_item"."source_document_id") INNER JOIN "yjb_case_reporting"."mvw_yp_document_header" AS "d" ON "yp_doc_header"."source_document_id" = "d"."source_document_id") LEFT JOIN "refdata"."yotoucodes" AS "yot" ON "yot"."yotoucode" = "d"."yot_ou_code" WHERE "yp_doc_item"."document_item_type" = CAST('person_details' AS VARCHAR)) AS "person_details" INNER JOIN (SELECT "o"."source_document_id" AS "source_document_id_offence", CAST("o"."document_item"."offenceid" AS VARCHAR) AS "offence_id", CAST("o"."document_item"."offencedate" AS DATE) AS "offence_date", CAST("o"."document_item"."ageatarrestoroffence" AS INT4) AS "age_at_arrest_or_offence", CAST("o"."document_item"."ageonfirsthearing" AS INT4) AS "age_at_first_hearing", CAST("o"."document_item"."offencedescription" AS VARCHAR) AS "offence_description", CAST("o"."document_item"."yjboffencecategory" AS VARCHAR(100)) AS "yjb_offence_category", CAST("o"."document_item"."kniferelatedoffence" AS VARCHAR(100)) AS "knife_related_offence", CAST("o"."document_item"."yjbseriousnessscore" AS INT4) AS "yjb_seriousness_score", CAST("olo"."legaloutcome" AS VARCHAR(100)) AS "legal_outcome", CAST("olo"."legaloutcomegroup" AS VARCHAR(100)) AS "legal_outcome_group", CAST("olo"."cmslegaloutcome" AS VARCHAR(100)) AS "cms_legal_outcome", CAST("olo"."outcomedate" AS DATE) AS "outcome_date", CAST("olo"."residenceonlegaloutcomedate" AS VARCHAR(100)) AS "residence_on_legal_outcome_date" FROM "stg"."yp_doc_item" AS "o" LEFT JOIN "o"."document_item"."offencelegaloutcome" AS "olo" ON CAST(TRUE AS BOOL) WHERE "o"."document_item_type" = CAST('offence' AS VARCHAR)) AS "offence" ON "person_details"."source_document_id" = "offence"."source_document_id_offence") LEFT JOIN (SELECT "yp_doc_item_1"."source_document_id" AS "source_document_id_asset_plus", CAST("yp_doc_item_1"."document_item"."roshjudgement" AS VARCHAR) AS "rosh_judgement", CAST("yp_doc_item_1"."document_item"."mappacategory" AS VARCHAR) AS "mappa_category", CAST("yp_doc_item_1"."document_item"."mappalevel" AS VARCHAR) AS "mappa_level", CAST("yp_doc_item_1"."document_item"."concernsoffencejustification" AS VARCHAR) AS "concerns_offence_justification", CAST("yp_doc_item_1"."document_item"."concernsoffencesattitudes" AS VARCHAR) AS "concerns_offence_attitudes", CAST("yp_doc_item_1"."document_item"."concernsotherbehaviour" AS VARCHAR) AS "concerns_other_behaviour", CAST("yp_doc_item_1"."document_item"."concernslocalissues" AS VARCHAR) AS "concerns_local_issues", CAST("yp_doc_item_1"."document_item"."concernsparenting" AS VARCHAR) AS "concerns_parenting", CAST("yp_doc_item_1"."document_item"."concernsfamilybehaviour" AS VARCHAR) AS "concerns_family_behaviour", CAST("yp_doc_item_1"."document_item"."concernscarehistory" AS VARCHAR) AS "concerns_care_history", CAST("yp_doc_item_1"."document_item"."concernssignificantrelationships" AS VARCHAR) AS "concerns_significant_relationships", CAST("yp_doc_item_1"."document_item"."concernsrelationstoothers" AS VARCHAR) AS "concerns_relations_to_others", CAST("yp_doc_item_1"."document_item"."concernsrisktoothers" AS VARCHAR) AS "concerns_risk_to_others", CAST("yp_doc_item_1"."document_item"."concernsphysicalhealth" AS VARCHAR) AS "concerns_physical_health", CAST("yp_doc_item_1"."document_item"."concernssafetywellbeing" AS VARCHAR) AS "concerns_safety_and_wellbeing", CAST("yp_doc_item_1"."document_item"."concernslifestyle" AS VARCHAR) AS "concerns_lifestyle", CAST("yp_doc_item_1"."document_item"."concernsmentalhealth" AS VARCHAR) AS "concerns_mental_health", CAST("yp_doc_item_1"."document_item"."concernsspeechlanguagecommunication" AS VARCHAR) AS "concerns_speech_language_communication", CAST("yp_doc_item_1"."document_item"."concernssubstancemisuse" AS VARCHAR) AS "concerns_substance_misuse", CAST("yp_doc_item_1"."document_item"."concernslearningandete" AS VARCHAR) AS "concerns_learning_and_ete", CAST("yp_doc_item_1"."document_item"."concernsaccommodation" AS VARCHAR) AS "concerns_accommodation", CAST("yp_doc_item_1"."document_item"."date" AS DATE) AS "asset_plus_date" FROM "stg"."yp_doc_item" AS "yp_doc_item_1" WHERE "yp_doc_item_1"."document_item_type" = CAST('asset_plus' AS VARCHAR)) AS "asset_plus" ON "person_details"."source_document_id" = "asset_plus"."source_document_id_asset_plus") LEFT JOIN (SELECT "yp_doc_item_2"."source_document_id" AS "source_document_id_assesment_stage", CAST("yp_doc_item_2"."document_item"."assessmentstagedetails"."assessmentdate" AS DATE) AS "assessment_date", CAST("yp_doc_item_2"."document_item"."assessmentstagedetails"."assessmentstage" AS DATE) AS "assessment_stage", CAST("yp_doc_item_2"."document_item"."assessmentstagedetails"."stagestartdate" AS DATE) AS "stage_start_date", CAST("yp_doc_item_2"."document_item"."assessmentstagedetails"."stageenddate" AS DATE) AS "stage_end_date" FROM "stg"."yp_doc_item" AS "yp_doc_item_2" WHERE "yp_doc_item_2"."document_item_type" = CAST('assessment_stage' AS VARCHAR)) AS "assessment_stage" ON "person_details"."source_document_id" = "assessment_stage"."source_document_id_assesment_stage";;	
CREATE VIEW yjb_ianda_team.filter_data_request_ecm_2023 AS SELECT derived_table1.source_document_id, derived_table1.ypid, derived_table1.date_of_birth, derived_table1.ethnicity, derived_table1.gender, derived_table1.sex, derived_table1.pncnumber, derived_table1.yot_name, derived_table1.age_at_arrest_or_offence, derived_table1.age_at_first_hearing, derived_table1.rosh_judgement, derived_table1.mappa_category, derived_table1.mappa_level, derived_table1.concerns_offence_justification, derived_table1.concerns_offence_attitudes, derived_table1.concerns_other_behaviour, derived_table1.concerns_local_issues, derived_table1.concerns_parenting, derived_table1.concerns_family_behaviour, derived_table1.concerns_care_history, derived_table1.concerns_significant_relationships, derived_table1.concerns_relations_to_others, derived_table1.concerns_risk_to_others, derived_table1.concerns_physical_health, derived_table1.concerns_safety_and_wellbeing, derived_table1.concerns_lifestyle, derived_table1.concerns_mental_health, derived_table1.concerns_speech_language_communication, derived_table1.concerns_substance_misuse, derived_table1.concerns_learning_and_ete, derived_table1.concerns_accommodation, derived_table1.offence_id, derived_table1.offence_date, derived_table1.offence_description, derived_table1.yjb_offence_category, derived_table1.knife_related_offence, derived_table1.yjb_seriousness_score, derived_table1.legal_outcome, derived_table1.legal_outcome_group, derived_table1.outcome_date, derived_table1.asset_plus_date, derived_table1.residence_on_legal_outcome_date, derived_table1.date_diff, derived_table1.rn FROM (SELECT filter_main.source_document_id, filter_main.ypid, filter_main.date_of_birth, filter_main.ethnicity, filter_main.gender, filter_main.sex, filter_main.pncnumber, filter_main.yot_name, filter_main.age_at_arrest_or_offence, filter_main.age_at_first_hearing, filter_main.rosh_judgement, filter_main.mappa_category, filter_main.mappa_level, filter_main.concerns_offence_justification, filter_main.concerns_offence_attitudes, filter_main.concerns_other_behaviour, filter_main.concerns_local_issues, filter_main.concerns_parenting, filter_main.concerns_family_behaviour, filter_main.concerns_care_history, filter_main.concerns_significant_relationships, filter_main.concerns_relations_to_others, filter_main.concerns_risk_to_others, filter_main.concerns_physical_health, filter_main.concerns_safety_and_wellbeing, filter_main.concerns_lifestyle, filter_main.concerns_mental_health, filter_main.concerns_speech_language_communication, filter_main.concerns_substance_misuse, filter_main.concerns_learning_and_ete, filter_main.concerns_accommodation, filter_main.offence_id, filter_main.offence_date, filter_main.offence_description, filter_main.yjb_offence_category, filter_main.knife_related_offence, filter_main.yjb_seriousness_score, filter_main.legal_outcome, filter_main.legal_outcome_group, filter_main.outcome_date, filter_main.asset_plus_date, filter_main.residence_on_legal_outcome_date, abs((filter_main.outcome_date - filter_main.asset_plus_date)) AS date_diff, pg_catalog.dense_rank() OVER(  PARTITION BY filter_main.ypid, filter_main.offence_id ORDER BY abs((filter_main.outcome_date - filter_main.asset_plus_date))) AS rn FROM (SELECT data_request_ecm_2023.source_document_id, data_request_ecm_2023.ypid, data_request_ecm_2023.date_of_birth, data_request_ecm_2023.ethnicity, data_request_ecm_2023.gender, data_request_ecm_2023.sex, data_request_ecm_2023.pncnumber, data_request_ecm_2023.yot_name, data_request_ecm_2023.age_at_arrest_or_offence, data_request_ecm_2023.age_at_first_hearing, data_request_ecm_2023.rosh_judgement, data_request_ecm_2023.mappa_category, data_request_ecm_2023.mappa_level, data_request_ecm_2023.concerns_offence_justification, data_request_ecm_2023.concerns_offence_attitudes, data_request_ecm_2023.concerns_other_behaviour, data_request_ecm_2023.concerns_local_issues, data_request_ecm_2023.concerns_parenting, data_request_ecm_2023.concerns_family_behaviour, data_request_ecm_2023.concerns_care_history, data_request_ecm_2023.concerns_significant_relationships, data_request_ecm_2023.concerns_relations_to_others, data_request_ecm_2023.concerns_risk_to_others, data_request_ecm_2023.concerns_physical_health, data_request_ecm_2023.concerns_safety_and_wellbeing, data_request_ecm_2023.concerns_lifestyle, data_request_ecm_2023.concerns_mental_health, data_request_ecm_2023.concerns_speech_language_communication, data_request_ecm_2023.concerns_substance_misuse, data_request_ecm_2023.concerns_learning_and_ete, data_request_ecm_2023.concerns_accommodation, data_request_ecm_2023.offence_id, data_request_ecm_2023.offence_date, data_request_ecm_2023.offence_description, data_request_ecm_2023.yjb_offence_category, data_request_ecm_2023.knife_related_offence, data_request_ecm_2023.yjb_seriousness_score, data_request_ecm_2023.legal_outcome, data_request_ecm_2023.legal_outcome_group, data_request_ecm_2023.outcome_date, data_request_ecm_2023.asset_plus_date, data_request_ecm_2023.residence_on_legal_outcome_date FROM yjb_ianda_team.data_request_ecm_2023 WHERE (((((((((((((((data_request_ecm_2023.yot_name)::text <> ('Bath and North East Somerset'::character varying)::text) AND ((data_request_ecm_2023.yot_name)::text <> ('Bristol'::character varying)::text)) AND ((data_request_ecm_2023.yot_name)::text <> ('North Somerset'::character varying)::text)) AND ((data_request_ecm_2023.yot_name)::text <> ('South Gloucestershire'::character varying)::text)) AND (data_request_ecm_2023.age_at_arrest_or_offence < 18)) AND (data_request_ecm_2023.age_at_first_hearing < 18)) AND (((((data_request_ecm_2023.legal_outcome_group)::text = ('Pre-Court'::character varying)::text) OR ((data_request_ecm_2023.legal_outcome_group)::text = ('First-tier'::character varying)::text)) OR ((data_request_ecm_2023.legal_outcome_group)::text = ('Community'::character varying)::text)) OR ((data_request_ecm_2023.legal_outcome_group)::text = ('Custody'::character varying)::text))) AND ((data_request_ecm_2023.legal_outcome_group)::text <> ('Changed on appeal'::character varying)::text)) AND ((data_request_ecm_2023.legal_outcome_group)::text <> ('Result of appeal unchanged'::character varying)::text)) AND (data_request_ecm_2023.outcome_date >= '2019-10-01'::date)) AND (data_request_ecm_2023.outcome_date <= '2021-11-30'::date)) AND (data_request_ecm_2023.asset_plus_date IS NOT NULL)) AND ((data_request_ecm_2023.yjb_offence_category)::text <> ('NOT_KNOWN'::character varying)::text)) AND ((data_request_ecm_2023.residence_on_legal_outcome_date)::text <> ('OTHER'::character varying)::text))) filter_main) derived_table1 WHERE (derived_table1.rn = 1);;	

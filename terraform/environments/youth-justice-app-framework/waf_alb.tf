
module "waf" {
  source             = "./modules/waf"
  project_name       = local.project_name
  tags               = local.tags
  waf_name           = "yjaf-default-alb"
  kms_key_arn        = module.kms.key_arn
  kms_key_id         = module.kms.key_id
  kms_key_us_east_1  = aws_kms_key.multi_region_replica.arn # WAF multi-region key

  providers = {
    aws           = aws
    aws.us-east-1 = aws.us-east-1
  }

  waf_IP_rules = {
    "Cloudfront" = {
      name        = "Cloudfront"
      priority    = 1
      description = "Cloudfront IP addresses"
      ip_addresses = ["99.84.0.0/16", "118.193.97.64/26", "3.35.130.128/25", "36.103.232.0/25", "18.192.142.0/23", "3.234.232.224/27", "65.9.128.0/18",
        "205.251.254.0/24", "180.163.57.0/25", "99.86.0.0/16", "52.56.127.0/25", "3.134.215.0/24", "116.129.226.0/25", "71.152.0.0/17",
        "54.192.0.0/16", "13.224.0.0/14", "52.52.191.128/26", "54.240.128.0/18", "8.64.0.0/14", "215.207.13.128/25", "3.101.158.0/23",
        "44.234.90.252/30", "52.57.254.0/24", "205.251.252.0/23", "3.236.169.192/26", "64.252.64.0/18", "3.231.2.0/25", "13.48.32.0/24",
        "120.52.153.192/26", "54.230.200.0/21", "119.147.182.128/26", "52.15.127.128/26", "89.95.239.217/32", "130.176.192.0/19",
        "52.82.128.0/19", "116.129.226.128/26", "54.230.128.0/18", "120.232.236.0/25", "52.47.139.0/24", "204.246.164.0/22", "13.124.199.0/24",
        "13.32.0.0/15", "54.182.0.0/16", "120.52.22.96/27", "89.95.239.194/32", "204.246.174.0/23", "13.35.0.0/16", "34.216.51.0/25",
        "205.251.249.0/24", "205.251.250.0/23", "223.71.11.0/27", "118.193.97.128/25", "119.147.182.0/25", "13.228.69.0/24",
        "130.176.128.0/18", "216.137.32.0/19", "120.253.240.192/26", "18.244.155.0/24", "52.66.194.128/26", "15.188.184.0/24", "52.222.128.0/17",
        "64.252.128.0/18", "120.253.245.192/27", "13.54.63.128/26", "35.167.191.128/26", "58.254.138.0/25", "52.220.191.0/26", "13.59.250.0/26",
        "34.226.14.0/24", "18.200.212.0/23", "223.71.71.128/25", "18.229.220.192/26", "35.162.63.192/26", "120.52.12.64/26", "180.163.57.128/26",
        "205.251.208.0/20", "86.170.169.39/32", "18.216.170.128/25", "34.223.12.224/27", "143.204.0.0/16", "204.246.168.0/22", "13.210.67.128/26",
        "13.233.177.192/26", "13.249.0.0/16", "3.128.93.0/24", "205.251.200.0/21", "35.158.136.0/24", "223.71.71.96/27", "52.124.128.0/17", "54.230.224.0/19",
        "144.220.0.0/16", "3.10.17.128/25", "54.230.208.0/20", "120.253.245.128/26", "54.230.0.0/17", "15.207.213.128/25", "44.227.178.0/24", "3.236.48.0/23",
        "52.84.0.0/15", "44.234.108.128/25", "204.246.172.0/24", "34.195.252.0/24", "65.9.0.0/17", "13.113.196.64/26", "65.8.0.0/16", "108.156.0.0/14",
        "130.176.224.0/20", "52.46.0.0/18", "52.199.127.192/26", "204.246.173.0/24", "120.232.236.128/26", "13.113.203.0/24", "54.233.255.128/26",
        "108.138.0.0/15", "70.132.0.0/18", "52.78.247.128/26", "36.103.232.128/26", "54.239.192.0/19", "54.239.128.0/18", "204.246.176.0/20",
        "120.253.241.160/27", "52.212.248.0/26", "3.11.53.0/24", "58.254.138.128/26", "99.79.169.0/24", "34.223.80.192/26", "130.176.0.0/17"
      ]
    },
    "falanx-ip-set" = {
      name         = "falanx-ip-set"
      priority     = 0
      description  = "Falanx IP addresses"
      ip_addresses = ["81.178.72.22/32", "154.59.121.128/27", "92.63.139.246/32", "154.59.121.0/24", "154.59.121.64/27", "37.128.189.24/32"]
    }
  }

  waf_geoIP_rules = [
    {
      name     = "GeoIP"
      priority = 3
      geo_match_statement = {
        country_codes = ["GB", "FR", "IE"]
      }
    }
  ]
}

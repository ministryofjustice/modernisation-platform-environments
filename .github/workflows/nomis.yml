---
name: nomis
on:
  push:
    branches:
      - main
    paths:
      - 'terraform/environments/nomis/**'
      - '.github/workflows/nomis.yml'

  pull_request:
    branches:
      - main
    types: [opened, edited, reopened, synchronize]
    paths:
      - 'terraform/environments/nomis/**'
      - '.github/workflows/nomis.yml'

  workflow_dispatch:

env:
  GITHUB_TOKEN: ${{ secrets.DSO_GITHUB_AUTOMATION_PAT }}
  TF_IN_AUTOMATION: true
  TF_VAR_BRANCH_NAME: ${{ github.event_name == 'pull_request' && 'main' || (github.head_ref || github.ref_name) }}
  TF_VAR_GH_ACTOR_NAME: ${{ github.actor}}
  AWS_REGION: "eu-west-2"
  ENVIRONMENT_MANAGEMENT: ${{ secrets.MODERNISATION_PLATFORM_ENVIRONMENTS }}

permissions:
  id-token: write  # This is required for requesting the JWT
  contents: read  # This is required for actions/checkout

defaults:
  run:
    shell: bash

jobs:

  plan-dev:
    uses: ministryofjustice/modernisation-platform-environments/.github/workflows/plan.yml@nomis/DSOS-1519/pipeline-improvements
    with:
      environment: development
      application: "${{ github.workflow }}"
    secrets: inherit

# runs-on: ubuntu-latest
# permissions:
#   id-token: write # This is required for requesting the JWT
#   contents: read # This is required for actions/checkout
# with:
#   environment: development
#   application: $GITHUB_WORKFLOW
# secrets:
#   modernisation_platform_environments: ${{ secrets.MODERNISATION_PLATFORM_ENVIRONMENTS }}
#   pipeline_github_token: ${{ secrets.DSO_GITHUB_AUTOMATION_PAT }}
